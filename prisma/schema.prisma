generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

enum ActStatus {
    draft
    generating
    ready
    failed
}

model User {
    id        String   @id @default(uuid())
    name      String
    edrpou    String? // ЕДРПОУ / ИНН
    email     String? // если будет auth
    phone     String?
    avatarUrl String?
    createdAt DateTime @default(now())

    clients Client[]
    acts    Act[]
}

model Act {
    id String @id @default(uuid())

    user   User   @relation(fields: [userId], references: [id])
    userId String

    client   Client @relation(fields: [clientId], references: [id])
    clientId String

    data            Json
    templateVersion String
    status          ActStatus @default(draft)

    createdAt DateTime @default(now())

    pdfs ActPdf[]

    @@index([userId])
    @@index([clientId])
    @@index([templateVersion])
}

model ActPdf {
    id              String   @id @default(uuid())
    act             Act      @relation(fields: [actId], references: [id])
    actId           String
    templateVersion String
    checksum        String
    fileUrl         String
    size            Int
    generatedAt     DateTime @default(now())

    @@index([actId])
}

model Client {
    id     String @id @default(uuid())
    user   User   @relation(fields: [userId], references: [id])
    userId String

    name        String
    edrpou      String?
    contactName String?
    phone       String?
    email       String?
    avatarUrl   String?

    createdAt DateTime @default(now())

    acts Act[]

    @@index([userId])
}
